"""test for pressure_at_given_opacity"""
from exojax.utils.opautils import pressure_at_given_opacity
import numpy as np
import jax.numpy as jnp

P_tauone_test = np.array([3.30222435, 1.72899939, 0.2545373])
Parr_test = jnp.array([0.01149757, 0.0145083, 0.01830737, 0.02310129, 0.02915053, 0.03678381, 0.04641591, 0.05857017, 0.07390719, 0.09326031, 0.11768121, 0.14849688, 0.18738183, 0.23644878, 0.29836458, 0.3764935, 0.47508106, 0.5994844, 0.7564637, 0.9545479, 1.2045032, 1.5199109, 1.9179106, 2.420129, 3.0538573, 3.8535266, 4.8626, 6.1359067, 7.7426376, 9.770103])
dtau_test = jnp.array([[2.3860786e-04, 7.0198922e-04, 9.2007332e-03], \
        [3.1485720e-04, 9.5418323e-04, 1.1888930e-02], \
        [4.1489382e-04, 1.2922562e-03, 1.5314096e-02], \
        [5.4604333e-04, 1.7437324e-03, 1.9662654e-02], \
        [7.1790628e-04, 2.3443357e-03, 2.5162695e-02], \
        [9.4308972e-04, 3.1401867e-03, 3.2090966e-02], \
        [1.2381971e-03, 4.1905059e-03, 4.0780526e-02], \
        [1.6251899e-03, 5.5708131e-03, 5.1627494e-02], \
        [2.1332619e-03, 7.3768678e-03, 6.5097034e-02], \
        [2.8014164e-03, 9.7290473e-03, 8.1725866e-02], \
        [3.6821794e-03, 1.2777391e-02, 1.0212136e-01], \
        [4.8467512e-03, 1.6707165e-02, 1.2695101e-01], \
        [6.3925204e-03, 2.1744551e-02, 1.5692469e-01], \
        [8.4538031e-03, 2.8162565e-02, 1.9275932e-01], \
        [1.1217215e-02, 3.6286909e-02, 2.3513055e-01], \
        [1.4944091e-02, 4.6502177e-02, 2.8461152e-01], \
        [2.0001957e-02, 5.9259512e-02, 3.4159195e-01], \
        [2.6908869e-02, 7.5088374e-02, 4.0621299e-01], \
        [3.6394514e-02, 9.4620168e-02, 4.7832122e-01], \
        [4.9481601e-02, 1.1863172e-01, 5.5749333e-01], \
        [6.7592382e-02, 1.4812517e-01, 6.4316219e-01], \
        [9.2682101e-02, 1.8445885e-01, 7.3487031e-01], \
        [1.2740263e-01, 2.2954579e-01, 8.3265626e-01], \
        [1.7529792e-01, 2.8611794e-01, 9.3753457e-01], \
        [2.4103267e-01, 3.5803714e-01, 1.0520209e+00], \
        [3.3064893e-01, 4.5060694e-01, 1.1806318e+00], \
        [4.5180354e-01, 5.7080060e-01, 1.3303472e+00], \
        [6.1392105e-01, 7.2738022e-01, 1.5110838e+00], \
        [8.2812244e-01, 9.3093783e-01, 1.7360477e+00], \
        [1.1068734e+00, 1.1940346e+00, 2.0217423e+00]])
        
def test_pressure_at_given_opacity():
    P_tauone = pressure_at_given_opacity(dtau_test, Parr_test)
    assert np.all(np.isclose(P_tauone/P_tauone_test, np.ones(3)))

if __name__ == '__main__':
    test_pressure_at_given_opacity()
